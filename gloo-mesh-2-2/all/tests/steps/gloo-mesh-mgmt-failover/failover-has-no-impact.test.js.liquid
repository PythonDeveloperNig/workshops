const chaiExec = require("@jsdevtools/chai-exec");
var chai = require('chai');
var expect = chai.expect;
chai.use(chaiExec);

describe("failover has no impact", () => {
  it("Istio objects haven't been modified", () => {
    let cli = chaiExec(`bash -c "kubectl --context ${process.env.CLUSTER1} get gw,vs,dr,se,we,envoyfilters -A -o json | jq -r '.items[].metadata.resourceVersion' | sort -u | tail -1"`);
    let last = chaiExec("cat last");

    expect(cli).to.exit.with.code(0);
    expect(cli).stdout.to.contain(last.stdout);
  });
});